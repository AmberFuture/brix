function BrixAccess(e={}){let t=!(!e.isAccess||"Y"!==e.isAccess),s=!(!e.isExtended||"Y"!==e.isExtended),i=!!e.wrap&&document.getElementById(""+e.wrap),a=e.names??{},n=[];if(this._container=null,this._containerClasses=e.classes?["access",...e.classes]:["access"],this._items=[],this._itemClasses="",this._btnClasses="",this._arSelected={},this.counter=0,e.options&&0<Object.keys(e.options).length){var l,r=e.options;for(l in s||n.push({value:"0",label:BX.message("BRIX_ACCESSES_CUSTOM_ACCESS_DEFAULT_OPT")}),r)n.push({value:Number(l),label:r[l].NAME})}this.getIsAccess=()=>t,this.getIsExtended=()=>s,this.getWrap=()=>i,this.getOptions=()=>n,e.items&&Object.values(e.items).forEach(e=>{var t=a[e.CODE]?this.getIsExtended()?(a[e.CODE].provider+" "+a[e.CODE].name).trim():a[e.CODE].name:"",t={id:e.ID,code:e.CODE,name:t,option:Number(e.TASK_ID),parent:!(!e.PARENT||"Y"!==e.PARENT)};t.parent||(this._arSelected[t.code]=!0),this.getIsExtended()||2!==Number(e.ID)?this._items.push(t):this._items.unshift(t)}),i&&(this.getClasses(),this.create(),this.createBtnAdd(),this.proxyHandler())}BrixAccess.prototype={get items(){return this._items},set items(e){"object"==typeof e&&e.hasOwnProperty("id")&&e.hasOwnProperty("code")&&e.hasOwnProperty("name")?this.proxy[this.proxy.length]=e:console.error("Required attributes were not passed")},getTemplates(){return{template:'<li class="${this._itemClasses}">${tempItem}</li>',templateView:'<p class="${this._textClasses}">${item.name}</p><p class="${this._textClasses}">${this.sanitizer(item.opt.label)}</p>',templateEdit:'<p class="${this._textClasses}">${this.sanitizer(item.name)}</p>${select}',templateTextDefault:'<p class="${this._titleClasses}">${BX.message(`BRIX_ACCESSES_CUSTOM_ACCESS_DEFAULT`)}</p>',templateTextGroup:'<p class="${this._titleClasses}">${BX.message(`BRIX_ACCESSES_CUSTOM_ACCESS_GROUPS`)}</p>',templateBtnDel:'<button class="${this._btnClasses} ui-btn ui-btn-link ui-btn-icon-cancel" type="button" aria-label="${BX.message(`BRIX_ACCESSES_CUSTOM_ACCESS_DEL`)}"></button>',templateSelect:'<div class="${this._blockClasses}"><div data-id="${item.code}"></div>${button}</div>'}},getClasses(){0<this._containerClasses.length&&(this._itemClasses=this._containerClasses.map(e=>e+"__item"),this._textClasses=this._containerClasses.map(e=>e+"__text"),this._titleClasses=this._containerClasses.map(e=>e+"__title"),this._blockClasses=this._containerClasses.map(e=>e+"__block"),this._btnClasses=this._containerClasses.map(e=>e+"__btn"),this._itemClasses=this._itemClasses.join(" "),this._textClasses=this._textClasses.join(" "),this._titleClasses=this._titleClasses.join(" "),this._blockClasses=this._blockClasses.join(" "),this._btnClasses=this._btnClasses.join(" "))},create(e="create"){var t;this._container||(this._container=document.createElement("ul"),this._containerClasses&&this._containerClasses.forEach(e=>{this._container.classList.add(e),this.getIsExtended()&&this._container.classList.add(e+"_extended")})),"del"===e?this._container&&0===this._container.children.length&&(this._container.remove(),this._container=null):"set"!==e&&this._items&&(e=this._items.filter(e=>e.parent),t=this._items.filter(e=>!e.parent),this._items=t,e&&e.forEach(e=>this.add(e)),this._items)&&this._items.forEach(e=>this.add(e)),this._container&&this.getWrap().prepend(this._container)},createBtnAdd(){var e;this.getIsExtended()&&this.getIsAccess()&&((e=document.createElement("button")).classList.add("access-add","ui-btn","ui-btn-link"),e.setAttribute("type","button"),e.textContent=BX.message("BRIX_ACCESSES_CUSTOM_ACCESS_ADD"),this.getWrap().appendChild(e),BX.Access.Init(this._arSelected),BX.Access.SetSelected(this._arSelected,"RIGHTS"),e.addEventListener("click",()=>{BX.Access.ShowForm({callback:BX.delegate(this.callRights,this),bind:"RIGHTS"})}))},callRights(e){for(var t in e)if(e.hasOwnProperty(t))for(var s in e[t])e[t].hasOwnProperty(s)&&(this.items={id:"n"+this.counter,code:s,name:(BX.Access.GetProviderPrefix(t,s)+" "+e[t][s].name).trim()},this.counter++)},proxyHandler(){this.proxy=new Proxy(this._items,this.handler())},sanitizer(e=""){return(new DOMParser).parseFromString(e,"text/html").body.textContent||""},add(item){let templates=this.getTemplates(),template="",button="",select=(this.getIsExtended()&&(button=templates.templateBtnDel.replace(/\${(.*?)}/g,(match,key)=>eval(key))),template=item.parent||!this.getIsAccess()?templates.templateView:templates.templateEdit,templates.templateSelect.replace(/\${(.*?)}/g,(match,key)=>eval(key))),tempItem="",str="",dom=(item.opt=this.getOptions().find(e=>Number(e.value)===Number(item.option)),this.getIsExtended()||(2===Number(item.id)?tempItem=templates.templateTextDefault.replace(/\${(.*?)}/g,(match,key)=>eval(key)):Number(item.id)===Number(this._items[1].id)&&(tempItem=templates.templateTextGroup.replace(/\${(.*?)}/g,(match,key)=>eval(key))),""!==tempItem&&(str=templates.template.replace(/\${(.*?)}/g,(match,key)=>eval(key)))),tempItem=template.replace(/\${(.*?)}/g,(match,key)=>eval(key)),str+=templates.template.replace(/\${(.*?)}/g,(match,key)=>eval(key)),(new DOMParser).parseFromString(str,"text/html").body),btn=dom.querySelector("button");if(btn&&btn.addEventListener("click",e=>this.delete(item.code)),[...dom.children].forEach(e=>this._container.appendChild(e)),this._container.querySelector(`[data-id="${item.code}"]`)){let bxSelect=new BX.Ui.Select({value:0===Number(item.option)?"0":item.option,options:this.getOptions(),isSearchable:!1});bxSelect.subscribe("update",e=>{this.change(item.code,bxSelect.getValue())}),bxSelect.renderTo(this._container.querySelector(`[data-id="${item.code}"]`))}},delete(t){var e=this._items.findIndex(e=>e.code===t);-1!==e&&delete this.proxy[e]},change(t,s){var e,i,a=this._items.findIndex(e=>e.code===t);-1!==a&&(e=this.proxy[a],i=this.getOptions().find(e=>Number(e.value)===Number(s)),e.option=Number(s),e.opt={id:Number(s),name:i.label},this.proxy[a]=e)},handler(){return{deleteProperty:(e,t)=>{var s=e[t].code,e=e.splice(t,1);return this._container.querySelector(`[data-id="${s}"]`)&&this._container.querySelector(`[data-id="${s}"]`).closest("li").remove(),delete this._arSelected[s],this.create("del"),e},set:(e,t,s)=>{s.hasOwnProperty("option")||(s.option=this.getOptions()[0].value),s.hasOwnProperty("parent")||(s.parent=!1);var i=e.find(e=>e.code===s.code);return e[t]=s,this.create("set"),i||this.add(s),!0}}}};