class BrixSecretSantaProfile{constructor(){this.player={},this.recipient={},this.config={},this.type=!1,this.container=document.querySelector(".intranet-user-profile-column-right"),this.container&&this.getConfig()}getConfig(){let e=this;BX.ajax.runAction("brix:secretsanta.Secretsanta.getConfig",{method:"get"}).then(t=>{t.data&&(e.config=t.data??{},e.getPlayer())},t=>{console.error(t)})}getPlayer(){let e=this;BX.ajax.runAction("brix:secretsanta.Secretsanta.getPlayer",{method:"get"}).then(t=>{t.data&&(e.player=t.data.player??{},e.recipient=t.data.recipient??{},e.type=t.data.type??!1,e.checkPlayer())},t=>{console.error(t)})}checkPlayer(){0!==Object.keys(this.player).length&&this.type&&("registration"===this.type?this.registration():"start"===this.type&&this.start())}registration(){let t=!1,e='<div class="intranet-user-profile-container-header"><div class="intranet-user-profile-container-title">'+this.config.gamename+"</div></div>",i=""!==this.config.datestart?this.config.textstart+"<b>"+this.config.datestart+"</b>":"",s=""!==this.config.dateend?this.config.textend+"<b>"+this.config.dateend+"</b>":"",r="";""!==i&&s&&(i+="<br><br>"),"Y"===this.player.TAKE_PART&&(a=""!==this.player.WISHLIST?this.player.WISHLIST:'<span class="ui-entity-editor-block-title" style="font: inherit;">'+this.config.wishempty+"</span>",r='<details class="ui-entity-editor-content-block"><summary style="cursor: pointer;">'+this.config.mywish+'</summary><div><div class="brix-secretsanta-profile__wish"><div class="brix-secretsanta-profile__text" style="padding: 10px 0;">'+a+"</div>",window.BXHtmlEditor?(t=!0,r+='<button class="ui-btn ui-btn-sm ui-btn-light-border ui-btn-round" id="brix-secretsanta-open-edit" type="button" data-value="N"><span class="ui-btn-text">'+this.config.edit[0]+'</span></button></div><div class="brix-secretsanta-profile__edit" style="display: none; padding: 10px 0;"><div class="feed-add-post-buttons --no-wrap" style="margin-top: 10px;"><button class="ui-btn ui-btn-sm ui-btn-primary" id="brix-secretsanta-save-wish" type="button"><span class="ui-btn-text">'+this.config.edit[1]+'</span></button><button class="ui-btn ui-btn-sm ui-btn-link" id="brix-secretsanta-close-edit"><span class="ui-btn-text">'+this.config.edit[2]+"</span></button></div></div>"):r+="</div>",r+="</div></details>");var a='<div class="ui-entity-editor-content-block">'+i+s+"</div>",n="Y"===this.player.TAKE_PART?'<button class="ui-btn ui-btn-sm ui-btn-light-border ui-btn-round" id="brix-secretsanta-utp" type="button" data-value="N"><span class="ui-btn-text">'+this.config.cancel+"</span></button>":'<button class="ui-btn ui-btn-sm ui-btn-primary ui-btn-round" id="brix-secretsanta-utp" type="button" data-value="Y"><span class="ui-btn-text">'+this.config.confirm+"</span></button>",a=(new DOMParser).parseFromString('<div class="intranet-user-profile-container brix-secretsanta-profile">'+e+'<div class="intranet-user-profile-container-body intranet-user-profile-about-wrapper"><div class="ui-entity-editor-content-block">'+a+r+n+"</div></div></div>","text/html");this.container.prepend(a.body.querySelector(".brix-secretsanta-profile")),this.updateTakePart(),t&&this.edit()}start(){if("Y"===this.player.TAKE_PART){let t='<div class="intranet-user-profile-container-header"><div class="intranet-user-profile-container-title">'+this.config.gamename+"</div></div>",e='<span class="ui-entity-editor-block-title" style="font: inherit;">'+this.config.wishempty+"</span>",i=""!==this.config.dateend?this.config.textend+"<b>"+this.config.dateend+"</b>":"",s=""!==this.recipient.link?this.config.recipient+this.recipient.link:"",r=""!==this.player.WISHLIST?this.player.WISHLIST:e,a=""!==this.recipient.wish?this.recipient.wish:e,n='<details class="ui-entity-editor-content-block"><summary style="cursor: pointer;">'+this.config.mywish+'</summary><div class="brix-secretsanta-profile__wish" style="padding: 10px 0;">'+r+"</div></details>",d=""!==this.recipient.link?'<details class="ui-entity-editor-content-block"><summary style="cursor: pointer;">'+this.config.recipientwich+'</summary><div class="brix-secretsanta-profile__wish" style="padding: 10px 0;">'+a+"</div></details>":"";""!==i&&""!==r&&(i+="<br><br>");var o=(new DOMParser).parseFromString('<div class="intranet-user-profile-container brix-secretsanta-profile">'+t+'<div class="intranet-user-profile-container-body intranet-user-profile-about-wrapper"><div class="ui-entity-editor-content-block"><div class="ui-entity-editor-content-block">'+i+s+"</div>"+d+n+"</div></div></div>","text/html");this.container.prepend(o.body.querySelector(".brix-secretsanta-profile"))}}updateTakePart(){let t=document.getElementById("brix-secretsanta-utp");t&&t.addEventListener("click",()=>{BX.ajax.runAction("brix:secretsanta.Secretsanta.updateTakePart",{method:"post",data:{takePart:t.getAttribute("data-value")}}).then(t=>{var e=BX.SidePanel.Instance.getTopSlider();e&&e.reload()},t=>{console.error(t)})})}edit(){let e=this,t=document.getElementById("brix-secretsanta-open-edit"),i=document.getElementById("brix-secretsanta-close-edit"),s=document.getElementById("brix-secretsanta-save-wish"),r=document.querySelector(".brix-secretsanta-profile__wish"),a=document.querySelector(".brix-secretsanta-profile__text"),n=document.querySelector(".brix-secretsanta-profile__edit");t&&i&&s&&r&&a&&n&&(t.addEventListener("click",()=>{e.createEditor(n),r.style.display="none",n.style.display="block"}),i.addEventListener("click",()=>{n.style.display="none",r.style.display="block",e.deleteEditor()}),s.addEventListener("click",()=>{var t;document.getElementById("bxed_brix-secretsanta-editor")&&(t=n.querySelector("iframe").contentDocument.body.innerHTML,BX.ajax.runAction("brix:secretsanta.Secretsanta.updateWishlist",{method:"post",data:{wishlist:t}}).then(t=>{t.data&&(a.innerHTML=""!==t.data.text?t.data.text:'<span class="ui-entity-editor-block-title" style="font: inherit;">'+e.config.wishempty+"</span>",e.player.WISHLIST=t.data.text,n.style.display="none",r.style.display="block",e.deleteEditor())},t=>{console.error(t)}))}))}createEditor(t){var e=(new DOMParser).parseFromString('<div class="bx-html-editor brix-secretsanta-profile__editor" id="bx-html-editor-brix-secretsanta-editor" data-name="brix-secretsanta-editor"> <div class="bxhtmled-toolbar-cnt" id="bx-html-editor-tlbr-cnt-brix-secretsanta-editor"> <div class="bxhtmled-toolbar" id="bx-html-editor-tlbr-brix-secretsanta-editor"></div> </div> <div class="bxhtmled-search-cnt" id="bx-html-editor-search-cnt-brix-secretsanta-editor" style="display: none;"></div> <div class="bxhtmled-area-cnt" id="bx-html-editor-area-cnt-brix-secretsanta-editor"> <div class="bxhtmled-iframe-cnt" id="bx-html-editor-iframe-cnt-brix-secretsanta-editor"></div> <div class="bxhtmled-textarea-cnt" id="bx-html-editor-ta-cnt-brix-secretsanta-editor"></div> <div class="bxhtmled-resizer-overlay" id="bx-html-editor-res-over-brix-secretsanta-editor"></div> <div id="bx-html-editor-split-resizer-brix-secretsanta-editor"></div> </div> <div class="bxhtmled-nav-cnt" id="bx-html-editor-nav-cnt-brix-secretsanta-editor" style="display: none;"></div> <div class="bxhtmled-taskbar-cnt bxhtmled-taskbar-hidden" id="bx-html-editor-tskbr-cnt-brix-secretsanta-editor"> <div class="bxhtmled-taskbar-top-cnt" id="bx-html-editor-tskbr-top-brix-secretsanta-editor"></div> <div class="bxhtmled-taskbar-resizer" id="bx-html-editor-tskbr-res-brix-secretsanta-editor"> <div class="bxhtmled-right-side-split-border"> <div data-bx-tsk-split-but="Y" class="bxhtmled-right-side-split-btn"></div> </div> </div> <div class="bxhtmled-taskbar-search-nothing" id="bxhed-tskbr-search-nothing-brix-secretsanta-editor"></div> <div class="bxhtmled-taskbar-search-cont" id="bxhed-tskbr-search-cnt-brix-secretsanta-editor" data-bx-type="taskbar_search"> <div class="bxhtmled-search-alignment" id="bxhed-tskbr-search-ali-brix-secretsanta-editor"> <input type="text" class="bxhtmled-search-inp" id="bxhed-tskbr-search-inp-brix-secretsanta-editor" placeholder=""/> </div> <div class="bxhtmled-search-cancel" data-bx-type="taskbar_search_cancel" title="HTMLED_SEARCH_CANCEL"></div> </div> </div> <div id="bx-html-editor-file-dialogs-brix-secretsanta-editor" style="display: none;"></div> </div>',"text/html"),t=(t.prepend(e.body.querySelector(".brix-secretsanta-profile__editor")),document.querySelector(".brix-secretsanta-profile__editor"));this.config.bxeditor.id=t.getAttribute("data-name"),this.config.bxeditor.inputName=t.getAttribute("data-name"),this.config.bxeditor.content=this.player.WISHLIST??"",window.BXHtmlEditor.Show(this.config.bxeditor)}deleteEditor(){delete window.BXHtmlEditor.editors["brix-secretsanta-editor"],document.querySelector(".brix-secretsanta-profile__editor").remove()}}document.addEventListener("DOMContentLoaded",()=>{new BrixSecretSantaProfile});