(()=>{var t=t=>jn.require(t);let e=t("apptheme"),i=t("secretsanta/ajax").ActionAjax,n=t("layout/ui/loading-screen").LoadingScreen,a=t("user/profile").ProfileView;var s=t("layout/pure-component").PureComponent;let o=t("layout/ui/text-editor").TextEditor,h=Object.freeze({container:{padding:10},scrollContainer:{paddingRight:8},text:{default:{marginBottom:8,opacity:.9,fontSize:18},title:{marginTop:8,marginBottom:12,fontSize:18,fontWeight:500,textDecorationLine:"underline"},wish:{marginBottom:8,fontSize:16},nowish:{marginBottom:8,opacity:.8,fontSize:15}},buttons:{default:{marginTop:8,maxWidth:"90%"},edit:{marginTop:8,marginBottom:12,maxWidth:"90%"}}});class l extends s{constructor(t){super(t),this.layout=t.layout,this.recipient={},this.config={},this.type=!1,this.player={},this.state={isLoading:!0}}componentDidMount(){this.getConfig()}showLoading(){this.setState({isLoading:!0})}hideLoading(){this.setState({isLoading:!1})}getConfig(){i.get("config").then(t=>{t.data&&(this.config=t.data??{},this.getPlayer())}).catch(t=>{this.hideLoading()})}getPlayer(){i.get("player",{isMobile:!0}).then(t=>{t.data&&(this.recipient=t.data.recipient??{},this.type=t.data.type??!1,this.player=t.data.player??{}),this.hideLoading()}).catch(t=>{this.hideLoading()})}registration(){return View({style:h.container},ScrollView({style:h.scrollContainer,showsVerticalScrollIndicator:!0},View({},""!==this.config.datestart?Text({style:h.text.default,html:this.config.textstart+"<b>"+this.config.datestart+"</b>"}):null,""!==this.config.dateend?Text({style:h.text.default,html:this.config.textend+"<b>"+this.config.dateend+"</b>"}):null,"Y"===this.player.TAKE_PART?View({},Text({style:h.text.title,text:this.config.mywish}),Text({style:""!==this.player.WISHLIST?h.text.wish:h.text.nowish,html:""!==this.player.WISHLIST?this.player.WISHLIST:this.config.wishempty}),View({style:h.buttons.edit},new PrimaryButton({rounded:!0,text:this.config.edit[0],onClick:()=>{o.open({title:this.config.mywish,text:this.player.EDIT_WISHLIST,onSave:t=>this.updateWishlist(t)})}})),View({style:h.buttons.default},new CancelButton({rounded:!0,text:this.config.cancel,onClick:()=>this.updateTakePart("N")}))):null,"Y"!==this.player.TAKE_PART?View({style:h.buttons.default},new PrimaryButton({rounded:!0,text:this.config.confirm,onClick:()=>this.updateTakePart()})):null)))}updateTakePart(e="Y"){this.showLoading(),i.post("takePart",{takePart:e}).then(t=>{this.player.TAKE_PART=e,this.hideLoading()}).catch(t=>{this.hideLoading()})}updateWishlist(t=null){this.showLoading(),t=t??"",i.post("wishlist",{wishlist:t,isMobile:!0}).then(t=>{t.data&&(this.player.WISHLIST=t.data.text,this.player.EDIT_WISHLIST=t.data.editText),this.hideLoading()}).catch(t=>{this.hideLoading()})}start(){return View({style:h.container},ScrollView({style:h.scrollContainer,showsVerticalScrollIndicator:!0},View({},"Y"===this.player.TAKE_PART?View({},""!==this.config.dateend?Text({style:h.text.default,html:this.config.textend+"<b>"+this.config.dateend+"</b>"}):null,""!==this.recipient.link?View({onClick:()=>{this.layout.openWidget("list",{backdrop:{bounceEnable:!1,swipeAllowed:!0,showOnTop:!0,hideNavigationBar:!0,horizontalSwipeAllowed:!1}}).then(t=>a.open({userId:this.recipient.id,isBackdrop:!0},t)).catch(console.error)}},Text({style:h.text.default,html:this.config.recipient+'<span style="color: '+e.colors.accentMainLinks+';">'+this.recipient.link+"</span>"}),Text({style:h.text.title,text:this.config.recipientwich}),Text({style:""!==this.recipient.wish?h.text.wish:h.text.nowish,html:""!==this.recipient.wish?this.recipient.wish:this.config.wishempty})):null):Text({style:h.text.default,text:this.config.notPart}))))}render(){var t;return this.editor=!1,this.state.isLoading?View({},new n):this.type?0===Object.keys(this.player).length?(t="registration"===this.type?this.config.notCheckPart:this.config.notPart,View({style:h.container},Text({style:h.text.default,text:t}))):"registration"===this.type?this.registration():"start"===this.type?this.start():void 0:View({})}}BX.onViewLoaded(()=>{layout.enableNavigationBarBorder(!1),layout.showComponent(new l({layout:layout}))})})();